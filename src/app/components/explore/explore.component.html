<div id="fixed-navigation">
    <nav id="actionbar">
        <ul>
            <ng-container *ngIf="isAuthenticated">
                <ng-container *ngIf="!isUploader()">
                    <li>
                        <button mat-flat-button
                                color="primary"
                                (click)="openUploadApplication()">Request upload capabilities
                        </button>
                    </li>
                </ng-container>
                <ng-container *ngIf="isUploader()">
                    <li>
                        <button mat-flat-button
                                color="primary"
                                (click)="openEntityCreation()">New Entity
                        </button>
                    </li>
                    <li>
                        <button mat-flat-button
                                color="primary"
                                (click)="openCompilationCreation()">New Compilation
                        </button>
                    </li>
                </ng-container>
            </ng-container>
            <li>
                <form>
                    <mat-form-field>
                        <input matInput placeholder="Search in Objects & Compilations" name="search-text"
                               [(ngModel)]="searchText" (ngModelChange)="searchTextChanged()">
                    </mat-form-field>
                </form>
            </li>
            <li>
                <div>
                    Objects
                    <mat-slide-toggle [checked]="showCompilations" (change)="toggleSlide()">
                    </mat-slide-toggle>
                    Compilations
                </div>
            </li>
            <li *ngIf="!showCompilations">
                <mat-form-field>
                    <mat-label>Media Types</mat-label>
                    <mat-select multiple [formControl]="mediaTypesSelected" [value]="mediaTypesSelected" (selectionChange)="updateMediaTypeOptions($event)">
                        <mat-option *ngFor="let option of mediaTypesOptions"
                                    [value]="option.value">{{ option.name }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </li>
            <li>
                <mat-form-field>
                    <mat-label>Filter Options</mat-label>
                    <mat-select multiple [formControl]="filterTypesSelected" [value]="filterTypesSelected" (selectionChange)="updateFilterTypeOptions($event)">
                        <mat-option *ngFor="let option of getFilterTypeOptions()" [value]="option.value">
                                {{ option.name }}
                                <mat-icon [matTooltip]="option.help" matTooltipPosition="above">help</mat-icon>
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </li>
        </ul>
    </nav>
</div>

<section class="content with-subnav"
         fxFlex
         fxLayout="column">

    <div class="sidebar"
         [ngClass]="{'sidebar-expanded': selectedElement}">

        <button mat-icon-button
                class="close-sidebar-button"
                (click)="closeSidebar()">
            <mat-icon>close</mat-icon>
        </button>

        <!-- Entity Detail View -->
        <div *ngIf="isEntity(selectedElement)"
             class="entity-details">

            <div class="entity-grid">
                <div class="grid-item">
                    <app-entity-interaction-menu [element]="selectedElement" [userData]="userData"></app-entity-interaction-menu>
                    <div (click)="select(selectedElement)">
                        <div class="image">
                            <img [src]="selectedElement.settings.preview"
                                 alt="{{selectedElement.name}}">
                        </div>
                        <div class="entity-type">
                            <mat-icon>{{icons[selectedElement.mediaType]}}</mat-icon>
                            <span class="type-text">{{ selectedElement.mediaType }}</span>
                        </div>
                        <div class="title">
                            <div class="titlewrapper">
                                {{ selectedElement.name }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <h2>Details</h2>
            <h3>{{selectedElement.name}}</h3>
            <p>{{selectedElement.relatedDigitalEntity.description}}</p>

            <h2>Licensing</h2>
            {{selectedElement.relatedDigitalEntity.licence}}

            <h2>Kompakkt Infos</h2>
            <ul>
                <li>ID: {{selectedElement._id}}</li>
                <li>Created: n</li>
                <li>Used in n Compilations</li>
                <li>Has n Annotations</li>
                <li>Connected to n Objects in Kompakkt</li>
            </ul>
        </div>

        <!-- Compilation Details -->
        <div *ngIf="isCompilation(selectedElement)"
             class="entity-details collection-details">
            <h1>{{selectedElement.name}}</h1>
            <p [innerHTML]="selectedElement.description"></p>
            <h3>{{selectedElement.entities.length}} Objects in Compilation</h3>
            <div class="entity-grid">
                <ng-container *ngFor="let entity of selectedElement.entities">
                    <div class="grid-item">
                        <app-entity-interaction-menu [element]="selectedElement" [userData]="userData"></app-entity-interaction-menu>
                        <div class="image">
                            <img [src]="entity.settings.preview"
                                 alt="{{entity.name}}">
                        </div>
                        <div class="entity-type">
                            <mat-icon>{{icons[entity.mediaType]}}</mat-icon>
                            <span class="type-text">{{ entity.mediaType }}</span>
                        </div>
                        <div class="title">
                            <div class="titlewrapper">
                                {{ entity.name }}
                            </div>
                        </div>
                    </div>
                </ng-container>
            </div>
        </div>
    </div>

    <div class="entity-grid"
         id="main"
         [ngClass]="{'sidebar-expanded': selectedElement}">
        <div *ngFor="let element of filteredResults" class="grid-item"
         [class.selected]="isSelected(element)">
            <app-entity-interaction-menu [element]="element" [userData]="userData"></app-entity-interaction-menu>
            <div (click)="select(element)">
                <div class="image">
                    <img *ngIf="isEntity(element)" [src]="element.settings.preview" alt="{{element.name}}">

                    <img *ngIf="isCompilation(element)" [src]="element.entities[0].settings.preview" alt="{{element.name}}">
                </div>
                <div class="entity-type">
                    <ng-container *ngIf="isEntity(element)">
                        <mat-icon>{{icons[element.mediaType]}}</mat-icon>
                        <span class="type-text">{{ element.mediaType }}</span>
                    </ng-container>

                    <ng-container *ngIf="isCompilation(element)">
                        <mat-icon>{{icons.collection}}</mat-icon>
                        <span class="type-text">Compilation</span>
                    </ng-container>
                </div>
                <div class="title">
                    <div class="titlewrapper">
                        {{ element.name }}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div fxLayout="row" fxLayoutAlign="start start">
        <mat-paginator fxFlex [length]="paginatorLength" [pageSize]="paginatorPageSize" [pageSizeOptions]="[20]" (page)="changePage($event)" [pageIndex]="paginatorPageIndex">
        </mat-paginator>
        <!-- Moves paginator more to the left if sidebar is opened -->
        <div fxFlex="50" *ngIf="selectedElement"></div>
    </div>

</section>

