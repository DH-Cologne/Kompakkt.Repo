<app-actionbar class="fixed"></app-actionbar>

<section *ngIf="objectReady"
         fxFlex
         class="content with-subnav">

    <div id="entity-detail">

        <div>
            <div class="iframe-container entity-viewer">
                <iframe [src]="viewerUrl | safe: 'resourceUrl'"
                        allowfullscreen></iframe>
            </div>
        </div>
        <div id="entity-data" *ngIf="object !== undefined">
            <div id="digital-object-obligatory-metadata">

                <!-- Obligatory Metadata Digital Object -->

                <div class="detail-block">
                    <h1 [innerHTML]="object.title"></h1>
                    <p [innerHTML]="object.description"></p>

                    <div id="actions">
                        <button mat-flat-button
                                matTooltip="Embed This Object on Your Web Page"
                                matTooltipPosition="above"
                                (click)="embed()">
                            <mat-icon>perm_media</mat-icon>
                        </button>
                        <a [href]="downloadJsonHref"
                           download="obj-{{objectID}}.json"
                           (click)="generateDownloadJsonUri();">
                            <button mat-flat-button
                                    matTooltip="Download Metadata"
                                    matTooltipPosition="below">
                                <mat-icon>list_alt</mat-icon>
                            </button>
                        </a>
                    </div>
                </div>

                <!-- Contact Person -->
                <div id="contact-person" class="detail-block"
                     *ngIf="getEntityPersonByRole(object, 'CONTACT_PERSON').length > 0">

                    <h2 [innerHTML]="'metadata.contact' | translate"></h2>
                    <div *ngFor="let contact of getEntityPersonByRole(object, 'CONTACT_PERSON')">
                        {{contact.prename}} {{contact.name}}<br>
                        <ng-container *ngIf="getContactRef(contact)">
                            {{getContactRef(contact).mail}}
                            <br>
                            {{getContactRef(contact).phonenumber}}
                        </ng-container>
                    </div>
                </div>
                <!-- /Contact Person -->

                <!-- Rights Owner -->
                <div class="detail-block">
                    {{'metadata.licence' | translate}}: <span [innerHTML]="object.licence"></span>
                </div>

                <div id="rights-owner" class="detail-block">
                    <h2 [innerHTML]="'metadata.rightsowner' | translate"></h2>

                    <div *ngFor="let owner of getEntityPersonByRole(object, 'RIGHTS_OWNER')">

                        <div *ngIf="owner.name">
                            {{owner.prename}} {{owner.name}}<br>
                            <ng-container *ngIf="getContactRef(owner)">
                                {{getContactRef(owner).mail}}
                                <br>
                                {{getContactRef(owner).phonenumber}}
                                <p *ngIf="getContactRef(owner).note">
                                    {{'metadata.person-note' | translate}}
                                    <br>
                                    {{getContactRef(owner).note}}
                                </p>
                            </ng-container>
                        </div>
                        <!-- ToDo: one to one or one to many relationship of owner.person_institution[0]['value']? -->
                        <div *ngFor="let inst of owner.institutions[object._id]">
                            <div *ngIf="inst.name">
                                {{inst.name}}<br>
                                {{inst.university}}<br>
                                <ng-container *ngIf="getAddress(inst)">
                                    {{getAddress(inst).street}} {{getAddress(inst).number}}<br>
                                    {{getAddress(inst).postcode}} {{getAddress(inst).city}}<br>
                                    {{getAddress(inst).country}}
                                </ng-container>
                            </div>

                            <div *ngIf="inst.notes[object._id]">
                                {{'metadata.institution-note' | translate}}: {{inst.notes[object._id]}}
                            </div>
                        </div>
                    </div>

                    <div *ngFor="let owner of getEntityInstitutionByRole(object, 'RIGHTS_OWNER')">
                        <div *ngIf="owner.name">
                            {{owner.name}}<br>
                            {{owner.university}}<br>
                            <ng-container *ngIf="getAddress(owner)">
                                {{getAddress(owner).street}} {{getAddress(owner).number}}<br>
                                {{getAddress(owner).postcode}} {{getAddress(owner).city}}<br>
                                {{getAddress(owner).country}}
                            </ng-container>
                        </div>

                        <div *ngIf="owner.notes[object._id]">
                            {{'metadata.institution-note' | translate}}: {{owner.notes[object._id]}}
                        </div>
                    </div>
                </div>
                <!-- / Rights Owner -->
            </div>
            <!-- /Obligatory Metadata Digital Object -->
            <mat-accordion
                    multi="true"
                    [togglePosition]="'before'">
                <mat-expansion-panel>
                    <mat-expansion-panel-header>
                        <mat-panel-title [innerHTML]="'metadata.optional' | translate">
                        </mat-panel-title>
                        <mat-panel-description>
                        </mat-panel-description>
                    </mat-expansion-panel-header>

                    <!-- Facultative Metadata Digital Object -->
                    <div id="digital-object-facultative-metadata">

                        <div *ngIf="object.discipline.length > 0">
                            <h3 [innerHTML]="'metadata.discipline' | translate"></h3>
                            <mat-chip-list>
                                <mat-chip *ngFor="let disc of object.discipline"
                                          [innerHTML]="disc"></mat-chip>
                            </mat-chip-list>
                        </div>

                        <div *ngIf="object.tags.length > 0">
                            <h3>Tags</h3>
                            <mat-chip-list>
                                <mat-chip *ngFor="let tag of object.tags"
                                          [innerHTML]="tag.value"></mat-chip>
                            </mat-chip-list>
                        </div>

                        <div *ngIf="object.objecttype.length > 0">
                            <h3 [innerHTML]="'metadata.objecttype' | translate"></h3>
                            {{object.objecttype}}
                        </div>

                        <div *ngIf="object.externalId.length > 0">
                            <h3 [innerHTML]="'metadata.id' | translate"></h3>
                            <div *ngFor="let identifier of object.externalId">
                                {{'metadata.id-type' | translate}}: {{identifier.type}}<br>
                                {{'metadata.id-value' | translate}}: {{identifier.value}}
                            </div>
                        </div>

                        <div *ngIf="object.dimensions.length > 0">
                            <h3 [innerHTML]="'metadata.dimensions' | translate"></h3>
                            <div *ngFor="let dimension of object.dimensions">
                                {{'metadata.dimensions-type' | translate}}: {{dimension.type}}<br>
                                {{'metadata.dimensions-value' | translate}}: {{dimension.value}}<br>
                                {{'metadata.dimensions-name' | translate}}: {{dimension.name}}
                            </div>
                        </div>

                        <div *ngIf="object.creation.length > 0">
                            <h3 [innerHTML]="'metadata.creation' | translate"></h3>
                            <div *ngFor="let creation of object.creation">
                                {{'metadata.creation-technique' | translate}}: {{creation.technique}}<br>
                                {{'metadata.creation-program' | translate}}: {{creation.program}}<br>
                                {{'metadata.creation-equipment' | translate}}: {{creation.equipment}}<br>
                                {{'metadata.creation-date' | translate}}: {{creation.date}}<br>
                            </div>
                        </div>

                        <!-- TODO: filter CONTACT_PERSON & RIGHTS_OWNER -->
                        <div *ngIf="object.persons && object.persons.length > 0">
                            <!-- ToDo Translate -->
                            <h3>Person</h3>
                            <div *ngFor="let person of object.persons">
                                {{person.prename}} {{person.name}}<br>
                                <ng-container *ngIf="getContactRef(person)">
                                    {{ getContactRef(person).mail }}
                                    <br>
                                    <ng-container *ngIf="getContactRef(person).phonenumber.length > 0">
                                        {{'metadata.person-phone' | translate}} :
                                        {{ getContactRef(person).phonenumber }}
                                        <br>
                                    </ng-container>
                                    {{'metadata.person-note' | translate}}: {{ getContactRef(person).note }}
                                </ng-container>
                                <!-- TODO: Role as chips? -->
                                <ng-container *ngIf="person.roles[object._id]">
                                    {{'metadata.person-role' | translate}}: {{person.roles[object._id]}}
                                </ng-container>
                            </div>
                        </div>

                        <div *ngIf="object.externalLink.length > 0">
                            <h3 [innerHTML]="'metadata.link' | translate"></h3>
                            <div *ngFor="let link of object.externalLink">
                                {{'metadata.link-description' | translate}}: {{link.description}}
                                {{'metadata.link-value' | translate}}: {{link.value}}
                            </div>
                        </div>

                        <!-- ToDo Check if link is correct -->
                        <div *ngIf="object.metadata_files.length > 0">
                            <h3 [innerHTML]="'metadata.external' | translate"></h3>
                            <a [href]="object.metadata_files[0]['metadata_file_link']" download>
                                {{'metadata.download-metadata' | translate}}
                            </a>
                        </div>

                        <div *ngIf="object.statement.length > 0">
                            <!-- ToDo Translate -->
                            <h3>Statement</h3>
                            <div [innerHTML]="object.statement"></div>
                        </div>

                    </div>
                    <!-- /Facultative Metadata Digital Object -->
                </mat-expansion-panel>

                <mat-expansion-panel *ngIf="object.phyObjs.length > 0">
                    <mat-expansion-panel-header>
                        <mat-panel-title [innerHTML]="'metadata.phy-obligatory-p2' | translate">
                        </mat-panel-title>
                        <mat-panel-description>
                        </mat-panel-description>
                    </mat-expansion-panel-header>

                    <!-- Metadata Physical Object -->
                    <div id="physical-object-obligatory-metadata"
                         *ngIf="object.phyObjs.length > 0">

                        <div *ngFor="let obj of object.phyObjs">

                            <h3 [innerHTML]="obj.title"></h3>
                            <p [innerHTML]="obj.description"></p>

                            <!-- TODO: Adjust to new data model -->
                            <div id="physical-object-rights-owner">

                                <h2 [innerHTML]="'metadata.rightsowner' | translate"></h2>

                                <div *ngFor="let owner of getEntityPersonByRole(obj, 'RIGHTS_OWNER')">
                                    <div *ngIf="owner.name">
                                        {{owner.prename}} {{owner.name}}<br>
                                        <ng-container *ngIf="getContactRef(owner)">
                                            {{getContactRef(owner).mail}}<br>
                                            {{getContactRef(owner).phonenumber}}
                                            <p *ngIf="getContactRef(owner).note">
                                                {{'metadata.person-note' | translate}}<br>
                                                {{getContactRef(owner).note}}
                                            </p>
                                        </ng-container>
                                    </div>
                                </div>
                                <div *ngFor="let owner of getEntityInstitutionByRole(obj, 'RIGHTS_OWNER')">
                                    <!-- ToDo: one to one or one to many relationship of owner.person_institution[0]['value']? -->
                                    <div *ngIf="owner.name">
                                        {{owner.name}}<br>
                                        {{owner.university}}<br>
                                        <ng-container *ngIf="getAddress(owner)">
                                            {{getAddress(owner).street}} {{getAddress(owner).number}}<br>
                                            {{getAddress(owner).postcode}} {{getAddress(owner).city}}<br>
                                            {{getAddress(owner).country}}
                                        </ng-container>
                                    </div>

                                    <div *ngIf="owner.notes[obj._id]">
                                        {{'metadata.institution-note' | translate}}: {{owner.notes[obj._id]}}
                                    </div>
                                </div>

                                <div *ngIf="obj.externalId.length > 0">
                                    <h3 [innerHTML]="'metadata.id' | translate"></h3>
                                    <div *ngFor="let identifier of obj.externalId">
                                        {{'metadata.id-type' | translate}}: {{identifier.externalId_type}}<br>
                                        {{'metadata.id-value' | translate}}: {{identifier.externalId_value}}
                                    </div>
                                </div>

                                <div *ngIf="obj.externalLink.length > 0">
                                    <h3 [innerHTML]="'metadata.link' | translate"></h3>
                                    <div *ngFor="let link of obj.externalLink">
                                        {{'metadata.link-description' | translate}}: {{link.externalLink_description}}
                                        {{'metadata.link-value' | translate}}: {{link.externalLink_value}}
                                    </div>
                                </div>

                                <div *ngIf="obj.place.length > 0">
                                    <h3 [innerHTML]="'metadata.place' | translate"></h3>
                                    <div *ngFor="let place of obj.place">
                                        {{place.placename}}<br>
                                        {{place.address.building}}<br>
                                        {{place.address.street}}
                                        {{place.address.number}}<br>
                                        {{place.address.postcode}} {{place.address.city}}<br>
                                        {{place.address.country}}

                                        {{place.geopolarea}}
                                    </div>
                                </div>

                                <!-- TODO: only contact or all? -->
                                <div *ngIf="obj.persons.length > 0">

                                    <h2 [innerHTML]="'metadata.contact' | translate"></h2>
                                    <div
                                            *ngFor="let contact of obj.persons">
                                        {{contact.prename}} {{contact.name}}<br>
                                        <ng-container *ngIf="getContactRef(contact)">
                                            {{getContactRef(contact).mail}}<br>
                                            {{getContactRef(contact).phonenumber}}
                                        </ng-container>
                                    </div>
                                </div>

                                <!-- ToDo Check consistency -->
                                <div *ngIf="obj.institutions.length > 0">
                                    <div *ngFor="let institution of obj.institutions">
                                        {{'metadata.institute' | translate}}:
                                        {{institution.name}}
                                        {{'metadata.address' | translate}}:
                                        <ng-container *ngIf="getAddress(institution)">
                                            {{getAddress(institution).street}}
                                            {{getAddress(institution).number}}
                                            ,
                                            {{getAddress(institution).postcode}}
                                            {{getAddress(institution).city}}
                                            {{'metadata.institution-building' | translate}}:
                                            {{getAddress(institution).building}}
                                            {{'metadata.institution-country' | translate}}:
                                            {{getAddress(institution).country}}
                                        </ng-container>
                                        {{'metadata.institution-role' | translate}}:
                                        {{institution.roles[obj._id]}}
                                        {{'metadata.institution-university' | translate}}:
                                        {{institution.university}}
                                        {{'metadata.institution-note' | translate}}:
                                        {{institution.notes[obj._id]}}
                                    </div>
                                </div>

                                <div *ngIf="obj.collection">
                                    <h3 [innerHTML]="'metadata.collection' | translate"></h3>
                                    <div [innerHTML]="obj.collection"></div>
                                </div>

                            </div>

                        </div>
                    </div>
                    <!-- /Metadata Physical Object -->
                </mat-expansion-panel>
            </mat-accordion>
        </div>

    </div>

</section>
