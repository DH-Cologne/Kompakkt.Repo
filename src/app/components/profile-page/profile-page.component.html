<div class="main-padding" *ngIf="!userData">
  <div class="detail-block">
    <div id="profile-page-container" class="data-incomplete">
      <h1>No data available for the current user</h1>
      <h4>You are either not logged in or your profile has not been fetched from the server</h4>
      <h4>Try logging out and logging back in</h4>
    </div>
  </div>
</div>

<div class="main-padding" *ngIf="userData">
  <div class="detail-block">
    <div id="profile-page-container" class="data-complete">
      <h3>Name: {{ userData.fullname ? userData.fullname : (userData.prename + ' ' + userData.surname) }}</h3>
      <h3>Mail: {{ userData.mail }}</h3>
      <h3>Role: {{ userData.role }}</h3>
    </div>

    <mat-tab-group mat-stretch-tabs>

      <mat-tab label="Entities">
        <div class="tab-help">
          <!-- TODO: Hide in "Help?"-Tooltip or Modal -->
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                What do the checkboxes mean?
              </mat-panel-title>
              <mat-panel-description>
                Click to show
              </mat-panel-description>
            </mat-expansion-panel-header>

            <p><b>Public</b> entities are searchable by everyone</p>
            <p><b>Restricted</b> entities are only searchable by <b>users</b> and/or <b>groups</b> assigned to the entity during or after entity creation. You can edit this at any point.</p>
            <p><b>Private</b> entities are only listed on <i>your</i> profile page for <i>your</i> eyes.</p>
            <p><b>Unfinished</b> entities are any entities that did not complete the upload process due to: settings not being set inside the viewer, file upload not being started or completed <i>or</i> an invalid or incomplete metadata form. You can continue working on unfinished entities from here.</p>
          </mat-expansion-panel>

          <div fxLayout="row" fxLayoutAlign="space-evenly center">
            <h3 fxFlex>What do you want to see:</h3>
            <mat-checkbox (change)="filter.public = !filter.public; updateFilter();" [checked]="filter.public" fxFlex>
              Public
            </mat-checkbox>
            <mat-checkbox (change)="filter.restricted = !filter.restricted; updateFilter();" [checked]="filter.restricted" fxFlex>
              Restricted
            </mat-checkbox>
            <mat-checkbox (change)="filter.private = !filter.private; updateFilter();" [checked]="filter.private" fxFlex>
              Private
            </mat-checkbox>
            <mat-checkbox (change)="filter.unfinished = !filter.unfinished; updateFilter();" [checked]="filter.unfinished" fxFlex>
              Unfinished
            </mat-checkbox>
          </div>
        </div>

        <div class="tab-main">
          <div *ngIf="filteredEntities.length === 0" fxLayout="column" fxLayoutAlign="space-evenly center">
            <h3>No matches</h3>
          </div>

          <div fxLayout="row wrap" fxLayoutAlign="space-evenly stretch">
            <div fxFlex="25" class="entity-grid-card-container" *ngFor="let entity of filteredEntities">
              <mat-card class="entity-grid-card">
                <img mat-card-image [src]="entity.settings.preview">
                <mat-card-title fxLayout="column" fxLayoutAlign="center center">{{ entity.name }}</mat-card-title>
                <mat-card-actions fxLayout="row" fxLayoutAlign="end center">
                  <button mat-icon-button matTooltip="View entity page"><mat-icon>remove_red_eye</mat-icon></button>
                  <button mat-icon-button matTooltip="Edit entity metadata"><mat-icon>edit</mat-icon></button>
                  <button (click)="openEntitySettings(entity)" mat-icon-button matTooltip="Entity settings"><mat-icon>settings</mat-icon></button>
                </mat-card-actions>
              </mat-card>
            </div>
          </div>
        </div>
      </mat-tab>

      <mat-tab label="Groups">
        <div class="tab-help" fxLayout="column" fxLayoutAlign="space-evenly center">
          <div class="tab-help-slider-container">
            <span>My groups</span>
            <mat-slide-toggle [(ngModel)]="showPartakingGroups"></mat-slide-toggle>
            <span>Groups I partake in</span>
          </div>
          <br>
          <button mat-raised-button (click)="openGroupCreation()">Create a new group</button>
        </div>

        <div class="tab-main">
          <!-- Groups created by the owner -->
          <ng-container *ngIf="!showPartakingGroups">
            <div *ngIf="getUserGroups().length === 0">
              <p>You have not created any groups</p>
            </div>

            <div fxLayout="row wrap" fxLayoutAlign="space-evenly stretch">
              <div fxFlex="25" class="entity-grid-card-container" *ngFor="let group of getUserGroups()">
                <mat-card class="entity-grid-card">
                  <mat-card-title>{{ group.name }}</mat-card-title>
                  <mat-card-subtitle>Members: {{ group.members.length }} | Owners: {{ group.owners.length }}</mat-card-subtitle>
                  <mat-card-actions fxLayout="row" fxLayoutAlign="end center">
                    <button mat-icon-button matTooltip="View members"><mat-icon>group</mat-icon></button>
                    <button mat-icon-button matTooltip="Edit group" (click)="openGroupCreation(group)"><mat-icon>edit</mat-icon></button>
                    <button mat-icon-button matTooltip="Delete group"><mat-icon>delete</mat-icon></button>
                  </mat-card-actions>
                </mat-card>
              </div>
            </div>
          </ng-container>

          <!-- Groups the user is part of as Member or Owner -->
          <ng-container *ngIf="showPartakingGroups">
            <div *ngIf="getPartakingGroups().length === 0">
              <p>You are not partaking in any group</p>
            </div>
            <div fxLayout="row wrap" fxLayoutAlign="space-evenly stretch">
              <div fxFlex="25" class="entity-grid-card-container" *ngFor="let group of getPartakingGroups()">
                <mat-card class="entity-grid-card">
                  <mat-card-title>{{ group.name }}</mat-card-title>
                  <mat-card-subtitle>Members: {{ group.members.length }} | Owners: {{ group.owners.length }}</mat-card-subtitle>
                  <mat-card-actions fxLayout="row" fxLayoutAlign="end center">
                    <button mat-icon-button matTooltip="View members"><mat-icon>group</mat-icon></button>
                    <button mat-icon-button matTooltip="Leave group"><mat-icon>directions_run</mat-icon></button>
                  </mat-card-actions>
                </mat-card>
              </div>
            </div>
          </ng-container>
        </div>
      </mat-tab>

      <mat-tab label="Compilations">
        <div class="tab-help" fxLayout="column" fxLayoutAlign="space-evenly center">
          <div class="tab-help-slider-container">
            <span>My compilations</span>
            <mat-slide-toggle [(ngModel)]="showPartakingCompilations"></mat-slide-toggle>
            <span>Compilations I partake in</span>
          </div>
        </div>

        <div class="tab-main">
          <ng-container *ngIf="!showPartakingCompilations">
            <div *ngIf="getUserCompilations().length === 0">
              <p>You do not have any compilations</p>
            </div>
          </ng-container>

          <ng-container *ngIf="showPartakingCompilations">
            <div *ngIf="getPartakingCompilations().length === 0">
              <p>You are not partaking in any compilations</p>
            </div>
          </ng-container>
        </div>
      </mat-tab>

      <!-- TODO:
        Eigener Tab?
        Überdenken wie Associated entities funktionieren

      <mat-tab label="Associated entities">
      </mat-tab>
    -->

      <!-- TODO:
        "Templates" als eigenen Datentyp, den man bearbeiten und löschen kann
        Unabhängig von DigitalEntities

      <mat-tab label="Metadata">
      </mat-tab> -->

    </mat-tab-group>

  </div>
</div>
